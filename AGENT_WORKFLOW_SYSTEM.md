# 주식투자 에이전트 협업 워크플로우 시스템

## 🚀 시스템 개요

주식투자 에이전트들 간의 지능적인 협업 워크플로우를 구현하여, 실시간 시장 분석부터 포트폴리오 최적화, 뉴스 이벤트 대응까지 자동화된 투자 의사결정 지원 시스템을 제공합니다.

## 🏗️ 시스템 아키텍처

### 1. 에이전트 간 통신 시스템 (`agent-communication.ts`)
- **목적**: 에이전트들 간의 실시간 메시지 교환 및 데이터 공유
- **특징**:
  - 우선순위 기반 메시지 큐잉
  - 에이전트 상태 모니터링 (온라인/오프라인/바쁨/오류)
  - 공유 데이터 저장소 with 만료 기능
  - 능력 기반 에이전트 자동 선택

### 2. 워크플로우 오케스트레이션 엔진 (`workflow-orchestrator.ts`)
- **목적**: 복잡한 다단계 워크플로우의 자동 실행 및 관리
- **특징**:
  - 토폴로지 정렬을 통한 의존성 해결
  - 병렬 실행 지원
  - 실패 시 재시도 로직
  - 실행 시간 추적 및 타임아웃 처리

### 3. 실시간 트리거 & 스케줄링 시스템 (`trigger-scheduler.ts`)
- **목적**: 시장 이벤트 감지 및 자동 워크플로우 트리거
- **특징**:
  - 다양한 트리거 타입 (가격 변동, 거래량 급증, 뉴스 이벤트)
  - 쿨다운 기간을 통한 과도한 트리거 방지
  - 시장 시간 인식 스케줄링
  - Cron 기반 정기 실행

### 4. 결과 통합 & 리포팅 시스템 (`report-integration.ts`)
- **목적**: 에이전트들의 분석 결과를 통합하여 종합 리포트 생성
- **특징**:
  - 자동 인사이트 추출
  - 신뢰도 기반 추천 생성
  - 다채널 알림 시스템 (푸시, 이메일, SMS, 대시보드)
  - 실시간 대시보드 업데이트

## 🤖 에이전트 특화 역할

### Bloomberg 데이터 애널리스트
- **전문 분야**: 실시간 시장 데이터 수집 및 기술적 분석
- **핵심 기능**:
  - 실시간 주가/거래량 모니터링
  - 기술적 지표 분석 (RSI, MACD, 볼린저 밴드)
  - 뉴스 감성 분석
  - 시장 심리 지표 추적

### Goldman Sachs 주식 애널리스트
- **전문 분야**: 개별 종목 펀더멘털 분석 및 투자 등급 평가
- **핵심 기능**:
  - SEC 파일링 분석 (13F, 10-K, 8-K)
  - DCF 밸류에이션 모델링
  - 실적 예측 및 가이던스 분석
  - 매수/보유/매도 등급 결정

### BlackRock 포트폴리오 매니저
- **전문 분야**: 포트폴리오 최적화 및 리스크 관리
- **핵심 기능**:
  - 마코위츠 평균-분산 최적화
  - 리스크 패리티 모델링
  - 리밸런싱 전략 수립
  - 성과 기여도 분석

## 🔄 워크플로우 시나리오

### 1. 실시간 시장 분석 워크플로우
```
Bloomberg → Goldman Sachs → BlackRock → 알림 생성
    ↓              ↓              ↓           ↓
시장 데이터    종목 분석    포트폴리오    사용자 알림
  수집         수행         영향 분석      생성
```

**실행 과정**:
1. Bloomberg 에이전트가 실시간 시장 데이터 수집
2. Goldman Sachs 에이전트가 개별 종목 분석 수행
3. BlackRock 에이전트가 포트폴리오 영향도 분석
4. 통합 리포트 생성 및 사용자 알림

### 2. 포트폴리오 최적화 워크플로우
```
현재 포트폴리오 → 종목 평가 → 시장 상황 → 최적화 → 리포트
분석 (BlackRock)  (Goldman)   분석 (Bloomberg)  (BlackRock)  생성
```

**실행 과정**:
1. 현재 포트폴리오 구성 및 성과 분석
2. 보유 종목별 펀더멘털 평가
3. 시장 상황 및 거시경제 환경 분석
4. 최적 자산 배분 계산 및 리밸런싱 계획 수립
5. 종합 최적화 리포트 생성

### 3. 뉴스 이벤트 대응 워크플로우
```
뉴스 감지 → 감성 분석 → 영향 종목 → 포트폴리오 → 긴급 알림
         (Bloomberg)   식별 (Goldman)  노출도 분석    발송
                                    (BlackRock)
```

**실행 과정**:
1. 중요 뉴스 이벤트 자동 감지
2. 뉴스 내용 및 감성 분석
3. 영향 받는 종목 및 섹터 식별
4. 사용자 포트폴리오 노출도 평가
5. 대응 방안 제시 및 긴급 알림 발송

## 🛡️ 리스크 관리 및 품질 보증

### 에러 처리 및 복구
- **재시도 메커니즘**: 실패한 스텝 자동 재시도 (설정 가능한 횟수)
- **서킷 브레이커**: 연속 실패 시 에이전트 일시 비활성화
- **롤백 지원**: 중요한 변경사항의 되돌리기 기능

### 신뢰도 관리
- **신뢰도 점수**: 각 분석 결과에 0-1 스케일 신뢰도 부여
- **크로스 검증**: 중요한 결정은 다수 에이전트 의견 종합
- **과거 성과 추적**: 에이전트별 예측 정확도 모니터링

### 성능 최적화
- **부하 분산**: 에이전트 부하 상태 기반 작업 배분
- **캐싱**: 자주 사용되는 데이터의 인메모리 캐싱
- **비동기 처리**: 논블로킹 메시지 처리

## 📊 모니터링 및 대시보드

### 실시간 대시보드 (`AgentWorkflowDashboard.tsx`)
- **에이전트 상태**: 각 에이전트의 온라인/오프라인/부하 상태
- **워크플로우 실행**: 현재 실행 중인 워크플로우 및 진행 상황
- **트리거 현황**: 활성화된 자동 트리거 규칙 관리
- **리포트 목록**: 최근 생성된 분석 리포트 목록

### 성과 지표
- **워크플로우 성공률**: 전체 워크플로우 대비 성공적 완료 비율
- **평균 실행 시간**: 워크플로우별 평균 완료 시간
- **에이전트 가용성**: 에이전트별 가동 시간 및 응답 시간
- **예측 정확도**: 투자 추천의 실제 성과 추적

## 🔧 API 엔드포인트

### `/api/agent-workflows`
- `GET ?action=status`: 전체 시스템 상태 조회
- `GET ?action=workflows`: 사용 가능한 워크플로우 목록
- `GET ?action=executions`: 실행 중인 워크플로우 목록
- `GET ?action=reports&limit=N`: 최근 리포트 N개 조회
- `POST action=execute-workflow`: 워크플로우 수동 실행
- `POST action=trigger-market-analysis`: 시장 분석 즉시 실행
- `POST action=optimize-portfolio`: 포트폴리오 최적화 실행
- `POST action=demo-workflow`: 데모 워크플로우 실행

## 🚀 사용 방법

### 1. 수동 워크플로우 실행
```javascript
// 포트폴리오 최적화 요청
const response = await fetch('/api/agent-workflows', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    action: 'optimize-portfolio',
    portfolioData: {
      id: 'user-portfolio-123',
      totalValue: 100000,
      holdings: [...]
    }
  })
});
```

### 2. 자동 트리거 설정
시스템에서 자동으로 감지하여 워크플로우 실행:
- **대형 주가 변동** (5% 이상): 실시간 시장 분석 실행
- **거래량 급증** (평균 대비 200% 이상): 시장 분석 실행
- **중요 뉴스 이벤트**: 뉴스 대응 워크플로우 실행
- **시장 급락** (3% 이상): 긴급 리스크 분석 실행

### 3. 대시보드 모니터링
`/agent-workflows` 페이지에서 실시간으로 모니터링:
- 에이전트 상태 및 부하
- 실행 중인 워크플로우
- 최근 분석 리포트
- 시스템 헬스 체크

## 🎯 주요 특징

### 지능형 협업
- **컨텍스트 공유**: 에이전트들이 분석 결과를 서로 참조
- **전문성 활용**: 각 에이전트의 전문 분야에 따른 역할 분담
- **시너지 효과**: 개별 에이전트보다 향상된 분석 품질

### 실시간 반응성
- **즉시 대응**: 중요 시장 이벤트 발생 시 자동 분석 시작
- **적응형 스케줄링**: 시장 시간 및 상황에 따른 유연한 실행
- **우선순위 관리**: 긴급도에 따른 워크플로우 우선순위 조정

### 확장성 및 유연성
- **모듈형 설계**: 새로운 에이전트 쉽게 추가 가능
- **커스텀 워크플로우**: 사용자 정의 워크플로우 생성 지원
- **다양한 트리거**: 시장 데이터, 뉴스, 시간 기반 등 다양한 트리거 지원

이 시스템을 통해 주식투자 의사결정에 필요한 복잡한 분석 과정을 자동화하고, 여러 전문 에이전트들의 지식을 효과적으로 결합하여 더 나은 투자 인사이트를 제공할 수 있습니다.