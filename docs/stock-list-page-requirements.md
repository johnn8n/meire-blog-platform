# 📋 메르 종목 리스트 페이지 요구사항

> **메르 블로그 플랫폼** 종목 리스트 페이지 (`/merry/stocks`) 개발을 위한 포괄적 요구사항 문서

---

## 🎯 **페이지 개요**

메르가 블로그에서 언급한 모든 종목들을 체계적으로 관리하고 필터링할 수 있는 종목 리스트 페이지

### 📊 **핵심 지표**
- **데이터 소스**: `stocks` 테이블 단일 소스
- **정렬 기준**: 최신 언급일 순 (같은 날짜는 언급 적은 순)
- **표시 방식**: 10개 종목 → "더보기" 클릭시 10개씩 추가 로딩
- **필터링**: 2단계 섹터 필터 + 검색 + 감정 필터

---

## 🔍 **필터 시스템**

### 🏷️ **2단계 섹터 필터링 (핵심 기능)**

#### **1단계: 대분류 섹터**
```typescript
const sectorCategories = {
  '기술/IT': ['Technology', '기술', '반도체', '전자상거래'],
  '에너지/원자력': ['에너지', '원자력', '우라늄'],
  '산업/제조': ['철강', '조선', '소재', '화학'],
  '운송/모빌리티': ['전기차'],
  '소비재/서비스': ['엔터테인먼트'],
  '신소재/배터리': ['배터리', '희토류']
};
```

#### **2단계: 세부 섹터**
- **동작 방식**: 대분류 선택시에만 세부 섹터 드롭다운 활성화
- **필터링 로직**: 대분류 → 세부 섹터 순차적 필터링
- **초기화**: 대분류 변경시 세부 섹터는 "전체" 상태로 초기화

### 🔎 **기타 필터**
- **검색 필터**: 종목명, 티커로 실시간 검색
- **감정 필터**: 긍정적, 부정적, 중립적, 전체
- **필터 초기화**: 모든 필터를 한번에 "전체" 상태로 초기화

---

## 📊 **데이터 관리 정책**

### 🗄️ **데이터 소스 및 업데이트 정책 (필수)**
- **단일 데이터 소스**: `stocks` 테이블만 사용
- **필터링 제거**: `is_merry_mentioned`, `mention_count > 0` 등 모든 조건 제거
- **통계 업데이트**: 총 종목 수는 `stocks` 테이블 기준으로 실시간 반영
- **페이지네이션**: 초기 10개 종목 표시, "더보기" 버튼으로 10개씩 추가 로딩

### 📈 **통계 카드 (동적 필터링)**
1. **총 종목 수**: 현재 적용된 필터링 결과에 따른 종목 수
2. **한국 종목**: 필터링된 결과 중 시장이 KOSPI인 종목 수
3. **미국 종목**: 필터링된 결과 중 시장이 NASDAQ, NYSE인 종목 수  
4. **전체 포스트 수**: 필터링된 종목들의 mention_count 합계

**📊 동적 반영 규칙**:
- **섹터 필터 변경시**: 선택된 섹터에 해당하는 종목들만 통계에 반영
- **검색 필터 적용시**: 검색 결과에 해당하는 종목들만 통계에 반영
- **감정 필터 적용시**: 해당 감정의 종목들만 통계에 반영
- **필터 조합시**: 모든 활성화된 필터 조건을 만족하는 종목들만 반영

---

## 🎨 **UI/UX 요구사항**

### 📱 **반응형 디자인**
- **모바일**: 1열 카드 레이아웃
- **태블릿**: 2열 카드 레이아웃
- **데스크탑**: 2열 카드 레이아웃 유지

### 🎯 **종목 카드 구성**
- **헤더**: 종목명, 감정 아이콘, 티커, 시장 배지
- **가격 정보**: 현재가, 등락률 (실시간 API 연동)
- **설명**: 회사 소개 (2줄 말줄임)
- **태그**: 관련 태그 최대 4개 표시
- **날짜**: 첫 언급일, 최근 언급일

### 🔄 **로딩 상태**
- **초기 로딩**: 기본 정보 먼저 표시 → 가격 정보 순차 로딩
- **가격 로딩**: 개별 종목별 스피너 표시
- **더보기 로딩**: 버튼 하단 로딩 스피너

---

## ⚡ **성능 최적화**

### 🚀 **로딩 전략**
1. **1단계**: 기본 종목 정보 빠른 로딩 (`pricesOnly=false`)
2. **2단계**: 가격 정보 병렬 백그라운드 로딩 (`pricesOnly=true`)
3. **페이지네이션**: 10개씩 분할 로딩으로 성능 보장

### 💾 **캐시 정책**
- **기본 정보**: 30분 캐시
- **가격 정보**: 5분 캐시
- **통계 데이터**: stocks 테이블 변경시 무효화

### 📊 **성능 기준**
- **초기 로딩**: < 1초 (기본 정보)
- **전체 로딩**: < 3초 (가격 정보 포함)
- **페이지네이션**: < 500ms
- **필터링**: < 100ms (클라이언트 사이드)

---

## 🧪 **테스트 요구사항**

### 📝 **기능 테스트**
- **2단계 섹터 필터**: 대분류 선택 → 세부 섹터 활성화
- **필터 조합**: 검색 + 섹터 + 감정 조합 필터링
- **페이지네이션**: "더보기" 버튼 클릭시 10개씩 로딩
- **실시간 데이터**: 가격 정보 정상 표시

### ⚡ **성능 테스트**
- **로딩 시간**: 각 단계별 로딩 시간 측정
- **메모리 사용량**: 대량 데이터 로딩시 메모리 누수 확인
- **네트워크 요청**: 불필요한 중복 요청 방지

---

## 🔧 **기술 구현 세부사항**

### 📊 **API 엔드포인트**
- **경로**: `/api/merry/stocks`
- **파라미터**:
  - `limit=10`: 페이지당 종목 수
  - `page=1`: 페이지 번호
  - `sector`: 섹터 필터링
  - `sentiment`: 감정 필터링
  - `pricesOnly`: 가격 정보만 로딩 여부

### 🗄️ **데이터베이스 쿼리**
```sql
SELECT 
  s.ticker, s.company_name, s.market, s.sector,
  s.mention_count, s.last_mentioned_date,
  s.description, s.tags,
  COUNT(pss.id) as analyzed_count
FROM stocks s
LEFT JOIN post_stock_sentiments pss ON s.ticker = pss.ticker
GROUP BY s.ticker
ORDER BY s.last_mentioned_date DESC NULLS LAST, s.mention_count ASC
```

### 🎯 **React 상태 관리**
```typescript
const [majorSectorFilter, setMajorSectorFilter] = useState('all');
const [subSectorFilter, setSubSectorFilter] = useState('all');
const [sentimentFilter, setSentimentFilter] = useState('all');
const [searchTerm, setSearchTerm] = useState('');
const [page, setPage] = useState(1);
const [hasMore, setHasMore] = useState(true);
```

---

## 🎨 **다크모드 지원**

### 🌙 **색상 시스템**
- **카드**: `bg-card dark:bg-card`
- **텍스트**: `text-foreground`, `text-muted-foreground`
- **태그**: `bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300`
- **배지**: 시장별 색상에 다크모드 대응

### 🎯 **상호작용**
- **호버**: `hover:shadow-md hover:scale-105`
- **클릭**: `cursor-pointer transition-all duration-200`
- **활성 필터**: `ring-2 ring-primary`

---

## 📋 **개발 체크리스트**

### ✅ **필수 구현 사항**
- [ ] 2단계 섹터 필터링 (대분류 → 세부)
- [ ] 페이지네이션 (10개씩 "더보기")
- [ ] 순차적 로딩 (기본정보 → 가격정보)
- [ ] stocks 테이블 단일 소스 정책
- [ ] 다크모드 완전 지원

### 🧪 **테스트 확인 사항**
- [ ] Playwright E2E 테스트 통과
- [ ] 성능 기준 달성 (3초 이내 로딩)
- [ ] 크로스 브라우저 호환성
- [ ] 모바일 반응형 테스트

---

> 📝 **마지막 업데이트**: 2025-08-22  
> 💬 **문의사항**: 이 요구사항에 대한 질문이나 개선사항이 있으면 언제든지 알려주세요.