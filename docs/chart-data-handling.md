# 📊 차트 데이터 처리 방식 문서

## 🎯 개요
메르 블로그 플랫폼의 주식 차트는 토스 증권의 차트 표시 방식을 벤치마킹하여 구현되었습니다.

## 📈 데이터 처리 방식

### 1. 하이브리드 방식 (현재 구현)
우리 플랫폼은 토스와 달리 시간별 가격 데이터가 없으므로 다음과 같은 하이브리드 방식을 채택했습니다:

#### 주말/휴일 처리
- **토스 방식 적용**: 주말(토요일, 일요일)은 차트에서 완전히 제외
- **이유**: 주식시장이 휴장이므로 데이터가 존재하지 않음
- **구현**: `dayOfWeek === 0 || dayOfWeek === 6` 조건으로 건너뛰기

#### 평일 누락 데이터 처리
- **우리 방식**: 평일인데 종가 데이터가 없는 경우 전날 종가로 대체
- **이유**: 일부 종목의 경우 거래가 없거나 데이터 수집 실패 가능성
- **구현**: `lastKnownPrice` 변수로 마지막 유효 가격 추적

### 2. 데이터 품질 표시

#### isActualData 플래그
```javascript
{
  date: "2025-08-21",
  price: 220.5,
  isActualData: true  // 실제 종가 데이터
}

{
  date: "2025-08-22", 
  price: 220.5,
  isActualData: false // 전날 가격으로 채워진 데이터
}
```

#### API 응답 내 품질 정보
```javascript
dataQuality: {
  totalDays: 180,        // 총 거래일 수
  actualDataDays: 175,   // 실제 데이터 일수
  filledDataDays: 5,     // 전날 가격으로 채운 일수
  dataMethod: '하이브리드 방식: 주말/휴일 제외, 평일 누락시 전날 가격 사용'
}
```

## 🗓️ X축 표시 방식 (토스 스타일)

### 거래일 인덱스 기반 표시
토스처럼 주말/휴일을 건너뛰고 거래일만 연속적으로 표시:

#### 1년 (1Y)
- 약 250 거래일 → 매월 1회 표시
- 간격: `totalDataPoints / 12`
- 표시: "1월", "2월", ..., "12월" (1월은 "2025년"으로 표시)

#### 6개월 (6M)
- 약 125 거래일 → 2주 간격 표시  
- 간격: `totalDataPoints / 12`
- 표시: "8/21", "9/4", "9/18" 형식

#### 3개월 (3M)
- 약 63 거래일 → 주 1회 표시
- 간격: `max(totalDataPoints / 12, 5)`
- 표시: "8/21", "8/28", "9/4" 형식

#### 1개월 (1M)
- 약 21 거래일 → 3-4일 간격 표시
- 간격: `max(totalDataPoints / 7, 3)`
- 표시: "8/21", "8/24", "8/27" 형식

### 중복 방지 로직
동일한 월/일이 반복 표시되지 않도록 이전 5개 틱 내 중복 확인

## 🔍 토스와의 차이점

### 토스 증권
- **데이터**: 실시간 및 시간별 가격 데이터 보유
- **차트 엔진**: TradingView 차트 사용
- **줌 기능**: 동적 시간 단위 변경 (줌인 시 분/시간 단위로 전환)

### 우리 플랫폼
- **데이터**: 일별 종가 데이터만 보유
- **차트 엔진**: Recharts 라이브러리 사용
- **줌 기능**: 제한적 (기간 선택만 가능)

## 💡 향후 개선 방향

1. **실시간 데이터 연동**
   - WebSocket을 통한 실시간 가격 업데이트
   - 시간별 데이터 수집 및 저장

2. **동적 시간 단위**
   - 줌 레벨에 따른 X축 단위 자동 변경
   - 일/주/월 단위 자동 전환

3. **데이터 품질 개선**
   - 누락 데이터 자동 보정 알고리즘
   - 데이터 소스 다변화

## 📝 참고사항

- 한국 주식(6자리 숫자)은 원화 단위로 표시
- 미국 주식은 달러 단위로 소수점 2자리까지 표시
- 모든 시간은 KST(한국 표준시) 기준
- 캐시 정책: 30분 캐싱으로 성능 최적화

---

*마지막 업데이트: 2025-08-22*